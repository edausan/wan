"use strict";(self.webpackChunkwan_bagtas=self.webpackChunkwan_bagtas||[]).push([[3135],{3135:function(e,n,t){t.r(n);var a=t(5861),r=t(9439),l=t(7757),s=t.n(l),o=t(8940),i=t(5094),c=t(148),u=t(5574),d=t(3239),p=t(7621),f=t(3400),h=t(2169),m=t(9504),v=t(7391),g=t(2363),x=t(6151),w=t(8439),b=t(2426),j=t.n(b),Z=t(2791),y=t(9431),_=t(9487),U=t(4054),L=t(184);n.default=function(){var e=(0,w.v0)(y.O).currentUser,n=(0,Z.useState)(null),t=(0,r.Z)(n,2),l=t[0],b=t[1],k=(0,Z.useState)(null),z=(0,r.Z)(k,2),R=z[0],S=z[1],C=(0,Z.useState)(null),N=(0,r.Z)(C,2),F=N[0],E=N[1],I=(0,Z.useState)(!1),M=(0,r.Z)(I,2),O=M[0],T=M[1],q=(0,U.Z)({quality:.9}),P=q.resized,A=q.processfile,B=(0,Z.useState)(!1),D=(0,r.Z)(B,2),H=D[0],V=D[1],W=(0,Z.useState)({secure_url:null}),G=(0,r.Z)(W,2),J=G[0],K=G[1];(0,Z.useEffect)((function(){console.log({resized:P}),K({secure_url:P})}),[P]);var Q=function(){var e=(0,a.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:E(null),b(null),K({secure_url:null});case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),X=function(){var e=(0,a.Z)(s().mark((function e(){var n,t,a,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V(!0),console.log({imageUpload:l}),n=new FormData,e.prev=3,n.append("file",l),n.append("upload_preset","uploads"),t=null===l||void 0===l?void 0:l.type.includes("video"),a="".concat("https://api.cloudinary.com/v1_1/edausan15","/").concat(t?"video":"image","/upload"),console.log(a,n.file),e.next=11,fetch(a,{method:"POST",body:n,mode:"cors"}).then((function(e){return e.json()}));case 11:(r=e.sent)&&(console.log({handleUploadToCloud:r}),E(r),V(!1)),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),console.log(e.t0.message);case 18:case"end":return e.stop()}}),e,null,[[3,15]])})));return function(){return e.apply(this,arguments)}}();(0,Z.useEffect)((function(){console.log({imageUpload:l}),l&&l.type.includes("image")&&A(l)}),[l]),(0,Z.useEffect)((function(){F&&Y()}),[F]);var Y=function(){var n=(0,a.Z)(s().mark((function n(){var t,a;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return T(!0),n.prev=1,t={uid:e.uid,message:R,media:F.secure_url,date_created:j()().format("LLLL"),reactions:[],comments:[],media_type:l.type},n.next=5,(0,_.iz)({post:t});case 5:a=n.sent,console.log({id:a.id}),null!==a&&void 0!==a&&a.id&&setTimeout((function(){K({secure_url:null}),S(null),b(null),E(null),T(!1)}),500),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(1),console.log(n.t0.message);case 13:case"end":return n.stop()}}),n,null,[[1,10]])})));return function(){return n.apply(this,arguments)}}();return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(u.Z,{open:H,children:(0,L.jsxs)("div",{className:"flex flex-col items-center p-4",children:[(0,L.jsx)(d.Z,{}),(0,L.jsx)("span",{className:"animate-pulse text-xs mt-2",children:"Uploading Media"})]})}),(0,L.jsxs)(p.Z,{className:"mb-4 relative",children:[J.secure_url&&(0,L.jsx)(f.Z,{className:"absolute z-[1003] top-[16px] right-[16px] bg-gray-800 hover:bg-gray-700",onClick:Q,children:(0,L.jsx)(o.Z,{})}),J.secure_url&&(0,L.jsx)(h.Z,{component:null!==l&&void 0!==l&&l.type.includes("image")?"img":"video",image:J.secure_url,id:"preview",autoPlay:!0,controls:!0}),(0,L.jsx)(m.Z,{sx:{pb:0},children:O?(0,L.jsx)("div",{children:R}):(0,L.jsx)(v.Z,{fullWidth:!0,variant:"standard",placeholder:"How's your day? Share it with us.",multiline:!0,onChange:function(e){return S(e.target.value)},disabled:O,value:R})}),(0,L.jsxs)(g.Z,{className:"justify-end",children:[(0,L.jsx)("label",{htmlFor:"icon-button-file",children:(0,L.jsxs)(x.Z,{component:"label","aria-label":"upload picture",disabled:O,startIcon:(0,L.jsx)(i.Z,{color:"success"}),children:[(0,L.jsx)("input",{hidden:!0,accept:"image/*,video/*",type:"file",onChange:function(e){var n=e.target.files[0];if(console.log({file:n}),n&&n.size<5e7){if(b(n),n.type.includes("video")){var t=URL.createObjectURL(n);K({secure_url:t})}}else alert("File is too large.")}}),(0,L.jsx)("span",{className:"!capitalize text-sm text-white/60",children:"Photo/Video"})]})}),(0,L.jsx)(x.Z,{startIcon:(0,L.jsx)(c.Z,{}),onClick:J?X:function(){},disabled:O||!R||!J,children:(0,L.jsx)("span",{className:"!capitalize text-sm text-white/60",children:"Share"})})]})]})]})}},4054:function(e,n,t){var a=t(9439),r=t(2791),l=t(2007),s=function(e){var n=e.quality,t=void 0===n?1:n,l=(0,r.useState)(null),s=(0,a.Z)(l,2),o=s[0],i=s[1],c=function(e){var n=document.createElement("canvas"),a=e.width,r=e.height;return a>r?a>620&&(r=Math.round(r*=620/a),a=620):r>620&&(a=Math.round(a*=620/r),r=620),n.width=a,n.height=r,n.getContext("2d").drawImage(e,0,0,a,r),n.toDataURL("image/webp",t)};return{resized:o,processfile:function(e){if(console.log("processfile"),!/image/i.test(null===e||void 0===e?void 0:e.type))return alert("File "+(null===e||void 0===e?void 0:e.name)+" is not an image."),!1;var n=new FileReader;n.readAsArrayBuffer(e),n.onload=function(e){var n=new Blob([e.target.result]);window.URL=window.URL||window.webkitURL;var t=window.URL.createObjectURL(n),a=new Image;a.src=t,console.log({blobURL:t}),a.onload=function(){var e=c(a);console.log({resized:e}),i(e)}}},resizeMe:c}};s.protoTypes={quality:t.n(l)().number},n.Z=s}}]);
//# sourceMappingURL=3135.c68e81c7.chunk.js.map